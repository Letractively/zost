# DESCRIÇÃO...................: PATCH PARA O BANCO DE DADOS DO BDO
# CORREÇÕES REALIZADAS........: ALTERAÇÃO DE CHAVES PARA QUE ELAS EXECUTEM UPDATES EM CASCATA
# COMPORTAMENTO PÓS-EXECUÇÃO..: A APLICAÇÃO DESTE PATCH DEVERÁ CORRIGIR ALGUNS ERROS COMUNS DE 
#                               SINCRONIZAÇÃO, PRINCIPALMENTE AQUELES QUE ACONTECIAM APÓS A 
#                               MANIPULAÇÃO DE TABELAS DO MÓDULO DE PERMISSÕES

USE BANCODEOBRAS;

ALTER TABLE ACOESDOSUSUARIOS DROP FOREIGN KEY EDS_ADU_FK;
ALTER TABLE ACOESDOSUSUARIOS ADD CONSTRAINT EDS_ADU_FK FOREIGN KEY (IN_ENTIDADESDOSISTEMA_FK) REFERENCES ENTIDADESDOSISTEMA (IN_ENTIDADESDOSISTEMA_PK) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE ACOESDOSUSUARIOS DROP FOREIGN KEY USU_ADU_FK;
ALTER TABLE ACOESDOSUSUARIOS ADD CONSTRAINT USU_ADU_FK FOREIGN KEY (SM_USUARIOS_FK) REFERENCES USUARIOS (SM_USUARIOS_PK) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE EQUIPAMENTOSDOSITENS DROP FOREIGN KEY ITE_EDI_FK;
ALTER TABLE EQUIPAMENTOSDOSITENS ADD CONSTRAINT ITE_EDI_FK FOREIGN KEY (IN_ITENS_FK) REFERENCES ITENS (IN_ITENS_PK) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE EQUIPAMENTOSDOSITENS DROP FOREIGN KEY EQP_EDI_FK;
ALTER TABLE EQUIPAMENTOSDOSITENS ADD CONSTRAINT EQP_EDI_FK FOREIGN KEY (IN_EQUIPAMENTOS_FK) REFERENCES EQUIPAMENTOS (IN_EQUIPAMENTOS_PK) ON DELETE RESTRICT ON UPDATE CASCADE;

ALTER TABLE GRUPOSDOSUSUARIOS DROP FOREIGN KEY USU_GDU_FK;
ALTER TABLE GRUPOSDOSUSUARIOS ADD CONSTRAINT USU_GDU_FK FOREIGN KEY (SM_USUARIOS_FK) REFERENCES USUARIOS (SM_USUARIOS_PK) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE GRUPOSDOSUSUARIOS DROP FOREIGN KEY GRU_GDU_FK;
ALTER TABLE GRUPOSDOSUSUARIOS ADD CONSTRAINT GRU_GDU_FK FOREIGN KEY (TI_GRUPOS_FK) REFERENCES GRUPOS (TI_GRUPOS_PK) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE ITENS DROP FOREIGN KEY PRO_ITE_FK;
ALTER TABLE ITENS ADD CONSTRAINT PRO_ITE_FK FOREIGN KEY (IN_PROPOSTAS_FK) REFERENCES PROPOSTAS (IN_PROPOSTAS_PK) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE ITENS DROP FOREIGN KEY FAM_ITE_FK;
ALTER TABLE ITENS ADD CONSTRAINT FAM_ITE_FK FOREIGN KEY (TI_FAMILIAS_FK) REFERENCES FAMILIAS (TI_FAMILIAS_PK) ON DELETE RESTRICT ON UPDATE CASCADE;
ALTER TABLE ITENS DROP FOREIGN KEY UNI_ITE_FK;
ALTER TABLE ITENS ADD CONSTRAINT UNI_ITE_FK FOREIGN KEY (TI_UNIDADES_FK) REFERENCES UNIDADES (TI_UNIDADES_PK) ON DELETE RESTRICT ON UPDATE CASCADE;

ALTER TABLE OBRAS DROP FOREIGN KEY REG_OBR_FK;
ALTER TABLE OBRAS ADD CONSTRAINT REG_OBR_FK FOREIGN KEY (TI_REGIOES_FK) REFERENCES REGIOES (TI_REGIOES_PK) ON DELETE RESTRICT ON UPDATE CASCADE;
ALTER TABLE OBRAS DROP FOREIGN KEY SIT_OBR_FK;
ALTER TABLE OBRAS ADD CONSTRAINT SIT_OBR_FK FOREIGN KEY (TI_SITUACOES_FK) REFERENCES SITUACOES (TI_SITUACOES_PK) ON DELETE RESTRICT ON UPDATE CASCADE;
ALTER TABLE OBRAS DROP FOREIGN KEY TIP_OBR_FK;
ALTER TABLE OBRAS ADD CONSTRAINT TIP_OBR_FK FOREIGN KEY (TI_TIPOS_FK) REFERENCES TIPOS (TI_TIPOS_PK) ON DELETE RESTRICT ON UPDATE CASCADE;
ALTER TABLE OBRAS DROP FOREIGN KEY PRJ_OBR_FK;
ALTER TABLE OBRAS ADD CONSTRAINT PRJ_OBR_FK FOREIGN KEY (SM_PROJETISTAS_FK) REFERENCES PROJETISTAS (SM_PROJETISTAS_PK) ON DELETE RESTRICT ON UPDATE CASCADE;

ALTER TABLE PERMISSOESDOSGRUPOS DROP FOREIGN KEY GRU_PDG_FK;
ALTER TABLE PERMISSOESDOSGRUPOS ADD CONSTRAINT GRU_PDG_FK FOREIGN KEY (TI_GRUPOS_FK) REFERENCES GRUPOS (TI_GRUPOS_PK) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE PERMISSOESDOSGRUPOS DROP FOREIGN KEY EDS_PDG_FK;
ALTER TABLE PERMISSOESDOSGRUPOS ADD CONSTRAINT EDS_PDG_FK FOREIGN KEY (IN_ENTIDADESDOSISTEMA_FK) REFERENCES ENTIDADESDOSISTEMA (IN_ENTIDADESDOSISTEMA_PK) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE PERMISSOESDOSUSUARIOS DROP FOREIGN KEY USU_PDU_FK;
ALTER TABLE PERMISSOESDOSUSUARIOS ADD CONSTRAINT USU_PDU_FK FOREIGN KEY (SM_USUARIOS_FK) REFERENCES USUARIOS (SM_USUARIOS_PK) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE PERMISSOESDOSUSUARIOS DROP FOREIGN KEY EDS_PDU_FK;
ALTER TABLE PERMISSOESDOSUSUARIOS ADD CONSTRAINT EDS_PDU_FK FOREIGN KEY (IN_ENTIDADESDOSISTEMA_FK) REFERENCES ENTIDADESDOSISTEMA (IN_ENTIDADESDOSISTEMA_PK) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE PROPOSTAS DROP FOREIGN KEY OBR_PRO_FK;
ALTER TABLE PROPOSTAS ADD CONSTRAINT OBR_PRO_FK FOREIGN KEY (IN_OBRAS_FK) REFERENCES OBRAS (IN_OBRAS_PK) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE PROPOSTAS DROP FOREIGN KEY INS_PRO_FK;
ALTER TABLE PROPOSTAS ADD CONSTRAINT INS_PRO_FK FOREIGN KEY (SM_INSTALADORES_FK) REFERENCES INSTALADORES (SM_INSTALADORES_PK) ON DELETE RESTRICT ON UPDATE CASCADE;

ALTER TABLE REGIOESDOSUSUARIOS DROP FOREIGN KEY REG_RDU_FK;
ALTER TABLE REGIOESDOSUSUARIOS ADD CONSTRAINT REG_RDU_FK FOREIGN KEY (TI_REGIOES_FK) REFERENCES REGIOES (TI_REGIOES_PK) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE REGIOESDOSUSUARIOS DROP FOREIGN KEY USU_RDU_FK;
ALTER TABLE REGIOESDOSUSUARIOS ADD CONSTRAINT USU_RDU_FK FOREIGN KEY (SM_USUARIOS_FK) REFERENCES USUARIOS (SM_USUARIOS_PK) ON DELETE CASCADE ON UPDATE CASCADE;
